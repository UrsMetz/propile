
<h1> Program Version: <%= @program.version %> </h1>

<div>
PAF = <%= @program.avgpaf.nil? ? "not yet calculated" : @program.avgpaf %>
<p> <%= link_to 'Calculate PAF for this program', controller: 'programs', action: 'calculate_paf', id: @program.to_param %> </p>
</div>

<div>
<%= link_to 'Export CSV', csv_program_path %>
</div>

<table class="ProgramMatrix">
  <tr> 
    <th></th>
    <% @program.eachTrack do |track| %> <th>Track <%= track %> </th> <% end %>
    <th></th>
  </tr>
  <% @program.eachSlot do |slot|
    no_more_columns_on_this_row = false
  %>
    <tr>
      <th> slot <%=slot%> </th> 
      <% @program.eachTrack do |track| program_entry = @program.entry(slot,track) %>
        <% if no_more_columns_on_this_row %>  &nbsp; 
        <% else %> 
          <%= render 'program_entries/show_in_program_matrix', :program_entry => program_entry, :program => @program, :slot => slot, :track => track  %>
          <% no_more_columns_on_this_row |= (!program_entry.nil? && program_entry.span_entire_row) %>
        <% end %> 
      <% end %>
      <td class="ProgramMatrix" > 
        <%= form_for(@program, :url => url_for(:action => 'insertSlot')) do |f| %>
          <%= hidden_field_tag "field[before]", slot %> <%= f.submit "insert slot"%>
        <% end %>
        <%= form_for(@program, :url => url_for(:action => 'removeSlot')) do |f| %>
          <%= hidden_field_tag "field[slot]", slot %> <%= f.submit "remove slot"%>
        <% end %>
      </td>
    </tr>
  <% end %>
  <tr>
    <td> </td>
    <% @program.eachTrack do |track| %> 
      <td class="ProgramMatrix" > 
        <%= form_for(@program, :url => url_for(:action => 'insertTrack')) do |f| %>
          <%= hidden_field_tag "field[before]", track %> <%= f.submit "insert track"%>
        <% end %>
        <%= form_for(@program, :url => url_for(:action => 'removeTrack')) do |f| %>
          <%= hidden_field_tag "field[track]", track %> <%= f.submit "remove track"%>
        <% end %>
      </td> 
    <% end %>
  </tr>
</table>

<div class="alignright">
  Created: <%= l @program.created_at %> -- 
  Modified: <%= l @program.updated_at %> 
</div>

<%= guarded_link_to 'Edit this program version-name', controller: 'programs', action: 'edit', id: @program.to_param %> |
<%= link_to 'New entry in this program', new_program_program_entry_path(@program) %>  |
